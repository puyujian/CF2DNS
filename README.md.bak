## CF2DNSï¼ˆCloudflare DNS ç®¡ç†é¢æ¿ï¼?
GitHub ä»“åº“ï¼šhttps://github.com/puyujian/CF2DNS

å‰åç«¯åˆ†ç¦»çš„ Cloudflare DNS è§£æè®°å½•ç®¡ç†é¢æ¿ã€‚åç«¯ä½¿ç”?Express ä»£ç† Cloudflare APIï¼Œå‰ç«¯ä½¿ç”?React + Vite + Tailwindã€‚æ”¯æŒ?Docker ä¸€ä½“åŒ–éƒ¨ç½²ï¼ˆAPI + é™æ€é¡µé¢åŒç«¯å£ï¼‰ï¼Œä¹Ÿæ”¯æŒ?GitHub Actions è‡ªåŠ¨æ„å»ºé•œåƒã€?
### åŠŸèƒ½ç‰¹æ€?- æŸ¥çœ‹è´¦å·ä¸‹æ‰€æœ?Zoneï¼ˆåŸŸåï¼‰
- æŸ¥çœ‹/æ–°å¢/ä¿®æ”¹/åˆ é™¤ DNS è§£æè®°å½•
- åç«¯ä»£ç† Cloudflare APIï¼Œå‰ç«¯ä¸æš´éœ² Token
- Docker ä¸€ä½“åŒ–è¿è¡Œï¼›ç”Ÿäº§ç¯å¢ƒåŒæºæä¾›å‰ç«?+ APIï¼Œæ— è·¨åŸŸçƒ¦æ¼

### ç›®å½•ç»“æ„
- `server/`ï¼šExpress åç«¯ï¼ˆä»£ç?Cloudflare APIï¼?- `client/`ï¼šReact å‰ç«¯ï¼ˆVite æ„å»ºï¼?- `Dockerfile`ã€`docker-compose.yml`ï¼šå®¹å™¨åŒ–ä¸ç¼–æ?- `.env.example`ï¼šç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼ˆå¤åˆ¶ä¸?`.env` å¹¶å¡«å†™ï¼‰

### Cloudflare Token æƒé™å»ºè®®
- å»ºè®®åˆ›å»ºæœ€å°æƒé™çš„ API Tokenï¼?  - Zone â†?Zone â†?Read
  - Zone â†?DNS â†?Edit
- ä½œç”¨åŸŸå¯è®¾ä¸ºéœ€è¦ç®¡ç†çš„ç‰¹å®š Zoneï¼ˆæ›´å®‰å…¨ï¼‰ï¼Œæˆ?All zonesï¼ˆæ›´æ–¹ä¾¿ï¼‰ã€?
### æœ¬åœ°å¼€å‘ï¼ˆNode 18+ï¼?1) å…‹éš†å¹¶è¿›å…¥ç›®å½•ï¼š
```
git clone https://github.com/puyujian/CF2DNS.git
cd CF2DNS
```

2) é…ç½®ç¯å¢ƒå˜é‡ï¼?- å¤åˆ¶æ ¹ç›®å½?`.env.example` â†?`.env`ï¼Œå¡«å†™ï¼š
  - `CLOUDFLARE_API_TOKEN=<ä½ çš„ Cloudflare API Token>`
  - å¯é€‰ï¼š`PORT=3000`ã€`CORS_ORIGIN=http://localhost:5173`

3) å¯åŠ¨åç«¯ï¼ˆé»˜è®?3000ï¼‰ï¼š
```
cd server
npm install
npm run dev
```

4) å¯åŠ¨å‰ç«¯ï¼ˆé»˜è®?5173ï¼‰ï¼š
```
cd client
npm install
npm run dev
```

5) è®¿é—®å‰ç«¯ï¼?- æ‰“å¼€ `http://localhost:5173`ï¼Œé€‰æ‹©åŸŸååç®¡ç†è§£æè®°å½•ã€?- å¼€å‘æ¨¡å¼ä¸‹å‰ç«¯é»˜è®¤è¯·æ±‚ `http://localhost:3000` çš?APIï¼›å¦‚éœ€è‡ªå®šä¹‰ï¼Œè®¾ç½® `VITE_API_BASE`ã€?
### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

é•œåƒåŒ…å«åç«¯ APIï¼ˆç«¯å?3000ï¼‰ä¸å‰ç«¯é™æ€æ–‡ä»¶ï¼ˆåŒæºæä¾›ï¼‰ã€?
æ–¹æ³• Aï¼šdocker composeï¼ˆé»˜è®¤ä½¿ç”?GHCR é•œåƒï¼?```
# 1) åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»º .env æˆ–å¯¼å‡ºå˜é‡?echo CLOUDFLARE_API_TOKEN=ä½ çš„Token > .env

# 2) å¯åŠ¨ï¼ˆé»˜è®¤æ‹‰å?ghcr.io/puyujian/cf2dns:latestï¼?docker compose up -d

# è®¿é—® http://localhost:3000
```

å¯é€‰ï¼šè¦†ç›–é•œåƒï¼ˆä¾‹å¦‚ä½¿ç”¨ç‰¹å®?SHA æ ‡ç­¾æˆ–ç§æœ‰é•œåƒï¼‰
```
IMAGE_NAME=ghcr.io/puyujian/cf2dns:sha-<çŸ­SHA> docker compose up -d
```

æ–¹æ³• Bï¼šç›´æ¥ä½¿ç”?Dockerfileï¼ˆæœ¬åœ°æ„å»ºï¼‰
```
# æ„å»ºé•œåƒ
docker build -t cf2dns:latest .

# è¿è¡Œå®¹å™¨
docker run --rm -p 3000:3000 \
  -e CLOUDFLARE_API_TOKEN=ä½ çš„Token \
  cf2dns:latest
```

æ–¹æ³• Cï¼šè„šæœ¬ï¼ˆWindows/*nixï¼?- Bashï¼?  - `./docker-build.sh`ï¼ˆæˆ– `./docker-build.sh yourname/cf2dns:latest`ï¼?  - `CLOUDFLARE_API_TOKEN=ä½ çš„Token ./docker-run.sh`ï¼ˆå¯å¸¦é•œåƒåå‚æ•°ï¼?- PowerShellï¼?  - `./docker-build.ps1 -ImageName yourname/cf2dns:latest`
  - `./docker-run.ps1 -ImageName yourname/cf2dns:latest -Token ä½ çš„Token`

å¯é€‰ï¼šåå‘ä»£ç†ï¼ˆä¾‹å¦?Nginx/Traefikï¼‰åœ¨ `:443` ä»£ç†åˆ°å®¹å™?`:3000`ï¼Œå¹¶é…ç½® TLS è¯ä¹¦ã€?
### GitHub Actionsï¼ˆæ¨é€åˆ° GHCRï¼Œå¹¶å¯é€‰æ¨é€åˆ° Docker Hubï¼?å·¥ä½œæµï¼š`.github/workflows/docker.yml`

- é»˜è®¤æ¨é€åˆ° GHCRï¼ˆGitHub Container Registryï¼‰ï¼Œé•œåƒå‘½åï¼?  - `ghcr.io/<owner>/<repo>:latest`
  - `ghcr.io/<owner>/<repo>:sha-<çŸ­SHA>`
- è¯¥å·¥ä½œæµä½¿ç”¨ `GITHUB_TOKEN` ç™»å½• GHCRï¼Œä¸éœ€è¦é¢å¤–é…ç½®ï¼›ä»“åº“éœ€å…è®¸ Packages å†™å…¥æƒé™ï¼ˆå·²åœ?workflow ä¸­å£°æ˜?`packages: write`ï¼‰ã€?
å¯é€‰ï¼šåŒæ—¶æ¨é€åˆ° Docker Hubï¼ˆå¦‚éœ€å¯¹å¤–åˆ†å‘åˆ?Docker Hubï¼?1) ä»“åº“ Settings â†?Secrets and variables â†?Actions é…ç½®ï¼?- `DOCKERHUB_USERNAME`ï¼šDocker Hub ç”¨æˆ·å?- `DOCKERHUB_TOKEN`ï¼šDocker Hub Access Tokenï¼ˆæˆ–å¯†ç ï¼?- å¯é€?`IMAGE_NAME`ï¼šè¦†ç›?Docker Hub æ¨é€ç›®æ ‡ï¼Œå¦?`yourname/cf2dns:latest`

2) æ¨é€åˆ° `main` æˆ–æ‰‹åŠ¨è§¦å?Workflowï¼?- å°†è‡ªåŠ¨ç™»å½?GHCR å¹¶æ¨é€ï¼›è‹¥é…ç½®äº† Docker Hub å‡­æ®ï¼Œä¹Ÿä¼šåŒæ—¶æ¨é€åˆ° Docker Hubã€?
3) æ‹‰å–ä¸è¿è¡Œï¼ˆGHCRï¼?```
docker pull ghcr.io/puyujian/cf2dns:latest
docker run --rm -p 3000:3000 \
  -e CLOUDFLARE_API_TOKEN=ä½ çš„Token \
  ghcr.io/puyujian/cf2dns:latest
```

### ç¯å¢ƒå˜é‡
- `CLOUDFLARE_API_TOKEN`ï¼ˆå¿…éœ€ï¼‰ï¼šCloudflare API Tokenï¼ˆæœ€å°æƒé™ï¼‰
- `PORT`ï¼ˆé»˜è®?3000ï¼‰ï¼šåç«¯ç›‘å¬ç«¯å£
- `CORS_ORIGIN`ï¼ˆå¼€å‘ç”¨äºè·¨åŸŸï¼‰ï¼šå…è®¸çš„å‰ç«¯æºï¼ˆå¼€å‘æ—¶ `http://localhost:5173`ï¼?- `VITE_API_BASE`ï¼ˆå‰ç«¯å¯é€‰ï¼‰ï¼šæŒ‡å®?API åŸºåœ°å€ï¼ˆé»˜è®¤ç”Ÿäº§åŒæºã€å¼€å‘æŒ‡å?3000ï¼?
### å¸¸è§é—®é¢˜ï¼ˆTroubleshootingï¼?- 401/403ï¼šToken æƒé™ä¸è¶³æˆ–æ— æ•ˆï¼›æŒ‰â€œToken æƒé™å»ºè®®â€æ£€æŸ¥é…ç½®ã€?- æ— æ³•åˆ—å‡º Zoneï¼šç¡®è®¤è´¦å·ä¸‹å­˜åœ¨ Zoneï¼›æˆ– Token ä½œç”¨åŸŸæ˜¯å¦ä»…é™ç‰¹å®?Zoneã€?- å¼€å‘è·¨åŸŸï¼šç¡®è®¤ `.env` ä¸?`CORS_ORIGIN=http://localhost:5173` å¹¶é‡å¯åç«¯ã€?- æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼š`docker compose logs -f` æˆ?`docker logs -f cf2dns`ã€?
